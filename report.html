<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç¶­ä¿®å›è¨ªå ±å‘Š</title>
  <link rel="stylesheet" href="style.css">
</head>
<body class="report-page">
  <!-- é ‚éƒ¨æ©«å¹…ï¼šæ•´å¹…å“ç‰Œæ©«å¹…ä½”æ»¿é é¢å¯¬åº¦ -->
  <header class="header">
    <img src="assets/banner_maqua.jpg" alt="MAQUA æœå‹™å°å›é¡§" class="banner">
  </header>
  <!-- ä¸»å…§å®¹å®¹å™¨ -->
  <main class="container">
    <!-- å•å€™èªåŠä¿é¤Šç´€éŒ„æŒ‰éˆ•å¡ç‰‡ -->
    <section class="intro-card">
      <div id="greeting" class="greeting-text">
        <div class="greeting-block">
          <span class="greeting-emoji" aria-hidden="true">ğŸ‘</span>
          <div class="greeting-lines">
            <p>ä»Šå¤©å·²ç¶“å¹«æ‚¨å®Œæˆé€™æ¬¡çš„ä¿é¤Šç¶­è­·ï¼Œè¨­å‚™ç‹€æ…‹ä¸€åˆ‡è‰¯å¥½ï¼Œè«‹å®‰å¿ƒä½¿ç”¨ï½</p>
            <p>æ„Ÿè¬ä¸€ç›´ä»¥ä¾†è®“æˆ‘å€‘é™ªä¼´åœ¨æ‚¨èº«é‚Šï¼</p>
          </div>
        </div>
        <p class="greeting-note">ä¸‹ä¸€æ¬¡ä¿é¤Šé è¨ˆæ–¼ <span id="nextDateInline">å¾…å®‰æ’</span>ï¼Œå±†æ™‚æˆ‘å€‘å°‡å†æ¬¡ç‚ºæ‚¨æœå‹™ã€‚</p>
        <p class="greeting-subline">æˆ‘å€‘æœƒä¸æ–·å„ªåŒ–æœå‹™ï¼Œæ‡‡è«‹ä½ å‘æˆ‘å€‘å¤§è†½è©•åƒ¹ï¼</p>
      </div>
      <div class="status-board" aria-live="polite">
        <div class="status-row">
          <span class="status-label">ä¸‹æ¬¡ä¿é¤Šæ™‚é–“</span>
          <span class="status-value" id="nextDateValue">å¾…å®‰æ’</span>
        </div>
        <div class="status-row">
          <span class="status-label">å•å·é€£çµ</span>
          <a class="status-value status-link" id="surveyLink" href="http://forms.gle/1mtZCkrerNMY8iZA8" target="_blank" rel="noopener noreferrer">http://forms.gle/1mtZCkrerNMY8iZA8</a>
        </div>
      </div>
      <button class="btn records-btn" type="button">ä¿é¤Šç´€éŒ„</button>
    </section>

    <!-- ä¿é¤Šç´€éŒ„åœ–ç‰‡è¼ªæ’­ -->
    <div id="slidesContainer" class="slides-wrapper"></div>
    <!-- ææä½ æŒ‰éˆ• -->
    <button class="btn tip-btn" type="button">ææä½ </button>
    <!-- å½±ç‰‡å †ç–Š -->
    <div class="videos-section">
      <!-- ç¬¬ä¸€å€‹å½±ç‰‡ï¼šé¡¯ç¤ºè‡ªå‹•æ–·æ°´è£ç½®ä»‹ç´¹ -->
      <div class="video-item">
        <video controls playsinline preload="metadata" poster="assets/poster_leak_stop.svg">
          <source src="assets/1252_1757912418.mp4" type="video/mp4">
        </video>
        <!-- æ¨™é¡Œè¦†è“‹æ–¼å½±ç‰‡é è¦½ï¼Œç°¡è¦æè¿°å½±ç‰‡å…§å®¹ï¼Œå¸å¼•ç”¨æˆ¶é»æ“Š -->
        <div class="caption">å…¨å±‹æ¼æ°´ä¸ç”¨æ€•ï¼1ç§’è‡ªå‹•æ–·æ°´é˜²ç½è£ç½®</div>
        <button class="play-overlay" aria-label="æ’­æ”¾"></button>
      </div>
      <!-- ç¬¬äºŒå€‹å½±ç‰‡ï¼šé¡¯ç¤ºå¦‚ä½•å¿«é€Ÿæ¢å¾©ç”¨æ°´ -->
      <div class="video-item">
        <video controls playsinline preload="metadata" poster="assets/poster_restore_water.svg">
          <source src="assets/1253_1757912439.mp4" type="video/mp4">
        </video>
        <div class="caption">å®¶è£¡çªç„¶æ–·æ°´ï¼Ÿ3æ­¥ç«‹åˆ»æå®š</div>
        <button class="play-overlay" aria-label="æ’­æ”¾"></button>
      </div>
    </div>

    <!-- æˆ‘å€‘çš„æœå‹™å€å¡Š -->
    <section class="services-wrapper">
      <!-- åœ–ç‰‡æœ¬èº«å·²åŒ…å« "æˆ‘å€‘çš„æœå‹™" æ¨™é¡Œï¼Œå› æ­¤ä¸é‡è¤‡é¡¯ç¤ºæ–‡å­— -->
      <img src="assets/services_grid.jpg" alt="æˆ‘å€‘çš„æœå‹™">
    </section>

    <!-- ä»‹ç´¹æœ‹å‹æœˆè²»çè³å€å¡Š -->
    <section class="referral-wrapper">
      <div class="referral-img-box">
        <!-- åœ–ç‰‡æœ¬èº«å·²æœ‰æ–‡æ¡ˆï¼Œç„¡éœ€é¡å¤–è¦†è“‹æ–‡å­— -->
        <img src="assets/referral_reward.jpg" alt="ä»‹ç´¹æœ‹å‹æœˆè²»çè³">
      </div>
      <button class="btn share-btn" type="button">åˆ†äº«å¥½å‹</button>
    </section>
  </main>
  <!-- åœ–ç‰‡æ”¾å¤§é¡¯ç¤ºé®ç½© -->
  <div id="imageOverlay" onclick="hideOverlay()">
    <img id="overlayImg" src="" alt="æ”¾å¤§åœ–ç‰‡">
  </div>

  <!-- å½±ç‰‡æ”¾å¤§æ’­æ”¾é®ç½© -->
  <div id="videoOverlay" onclick="hideVideoOverlay(event)">
    <video id="overlayVideo" controls playsinline></video>
  </div>
  <!-- è¼‰å…¥å ±å‘Šåœ–ç‰‡çš„è…³æœ¬ï¼šæ”¯æ´ ids åƒæ•¸å’Œ urls åƒæ•¸ -->
  <script>
    /**
     * å–å¾—ç¶²å€æŸ¥è©¢åƒæ•¸
     * @param {string} name åƒæ•¸åç¨±
     * @returns {string|null}
     */
    function getQueryParam(name) {
      const params = new URLSearchParams(window.location.search);
      return params.get(name);
    }

    // ç²å–è¼ªæ’­å®¹å™¨
    const slidesContainer = document.getElementById('slidesContainer');
    const idsParam = getQueryParam('ids');
    const urlsParam = getQueryParam('urls');

    /**
     * å°‡åœ–ç‰‡ç¶²å€ï¼ˆæˆ– public_idï¼‰å»ºç«‹ç‚ºè¼ªæ’­å¹»ç‡ˆç‰‡
     * @param {string[]} list åœ–ç‰‡ç¶²å€æˆ– public_id é™£åˆ—
     */
    function appendImages(list) {
      list.forEach(item => {
        const slide = document.createElement('div');
        slide.classList.add('slide');
        const img = document.createElement('img');
        // å¦‚æœåŒ…å« http(s) é–‹é ­è¦–ç‚ºå®Œæ•´ç¶²å€ï¼›å¦å‰‡è¦–ç‚º Cloudinary public_id
        if (/^https?:\/\//i.test(item)) {
          img.src = item;
        } else {
          // å¦‚æœæ²’æœ‰å‰¯æª”åï¼Œé è¨­ä½¿ç”¨ .jpg
          const hasExt = /\.(jpg|jpeg|png|gif|webp)$/i.test(item);
          const idWithExt = hasExt ? item : `${item}.jpg`;
          img.src = `https://res.cloudinary.com/djw2gafqe/image/upload/${idWithExt}`;
        }
        // é»æ“Šåœ–ç‰‡æ™‚é¡¯ç¤ºè¦†è“‹å±¤å¤§åœ–
        img.style.cursor = 'pointer';
        img.addEventListener('click', () => {
          showOverlay(img.src);
        });
        slide.appendChild(img);
        slidesContainer.appendChild(slide);
      });
      // ä¸éœ€æ›´æ–°ä½ç½®ï¼šä½¿ç”¨ scroll-snap
    }

    // ä¸å†éœ€è¦ updateSlideï¼šä½¿ç”¨ scroll-snap è‡ªå‹•å°é½Š

    // ä¸å†éœ€è¦å·¦å³æŒ‰éˆ•ï¼Œä½¿ç”¨æ»‘å‹•å’Œ scroll-snap

    // é¡¯ç¤ºæ”¾å¤§çš„åœ–ç‰‡
    function showOverlay(src) {
      const overlay = document.getElementById('imageOverlay');
      const overlayImg = document.getElementById('overlayImg');
      overlayImg.src = src;
      overlay.style.display = 'flex';
    }

    // éš±è—æ”¾å¤§çš„åœ–ç‰‡
    function hideOverlay() {
      const overlay = document.getElementById('imageOverlay');
      overlay.style.display = 'none';
    }

    // é¡¯ç¤ºå½±ç‰‡æ”¾å¤§è¦†è“‹å±¤
    function showVideoOverlay(src) {
      const overlay = document.getElementById('videoOverlay');
      const videoEl = document.getElementById('overlayVideo');
      if (!videoEl) return;
      videoEl.src = src;
      overlay.style.display = 'flex';
      // å˜—è©¦è‡ªå‹•æ’­æ”¾å½±ç‰‡
      setTimeout(() => {
        try { videoEl.play(); } catch (e) {}
      }, 0);
    }
    // éš±è—å½±ç‰‡æ”¾å¤§è¦†è“‹å±¤
    function hideVideoOverlay(event) {
      // å¦‚æœé»æ“Šçš„æ˜¯å½±ç‰‡æœ¬èº«ï¼Œå‰‡ä¸è¦é—œé–‰è¦†è“‹å±¤
      if (event && event.target && event.target.id === 'overlayVideo') return;
      const overlay = document.getElementById('videoOverlay');
      const videoEl = document.getElementById('overlayVideo');
      if (videoEl) {
        try { videoEl.pause(); } catch (e) {}
        videoEl.removeAttribute('src');
      }
      overlay.style.display = 'none';
    }

    if (urlsParam) {
      try {
        const decoded = decodeURIComponent(urlsParam);
        const list = decoded.split(',').filter(Boolean);
        if (list.length) {
          appendImages(list);
        } else {
          if (slidesContainer) slidesContainer.innerHTML = '<p>æ²’æœ‰æ‰¾åˆ°ç…§ç‰‡è³‡æ–™ã€‚</p>';
        }
      } catch (err) {
        console.error('è§£æåœ–ç‰‡ç¶²å€å¤±æ•—:', err);
        if (slidesContainer) slidesContainer.innerHTML = '<p>è§£æåœ–ç‰‡ç¶²å€å¤±æ•—ã€‚</p>';
      }
    } else if (idsParam) {
      try {
        const decodedIds = decodeURIComponent(idsParam);
        const list = decodedIds.split(',').filter(Boolean);
        if (list.length) {
          appendImages(list);
        } else {
          if (slidesContainer) slidesContainer.innerHTML = '<p>æ²’æœ‰æ‰¾åˆ°ç…§ç‰‡è³‡æ–™ã€‚</p>';
        }
      } catch (err) {
        console.error('è§£æåœ–ç‰‡æ¨™è­˜å¤±æ•—:', err);
        if (slidesContainer) slidesContainer.innerHTML = '<p>è§£æåœ–ç‰‡æ¨™è­˜å¤±æ•—ã€‚</p>';
      }
    } else {
      if (slidesContainer) slidesContainer.innerHTML = '<p>æ²’æœ‰æ‰¾åˆ°ç…§ç‰‡è³‡æ–™ã€‚</p>';
    }

    // æ›´æ–°ä¸‹ä¸€æ¬¡ä¿é¤Šæ—¥æœŸæ–‡å­—ï¼Œæ”¾åœ¨åœ–ç‰‡è™•ç†å®Œæˆå¾Œ
    (function updateNextDate() {
      const dateEl = document.getElementById('nextDateValue');
      const inlineDateEl = document.getElementById('nextDateInline');
      const surveyEl = document.getElementById('surveyLink');
      if (surveyEl && !surveyEl.textContent.trim()) {
        surveyEl.textContent = surveyEl.href;
      }
      if (!dateEl) return;
      const dateParam = getQueryParam('date');
      if (dateParam) {
        try {
          const parts = dateParam.split('-');
          if (parts.length === 3) {
            const y = parseInt(parts[0], 10);
            const m = parseInt(parts[1], 10);
            const d = parseInt(parts[2], 10);
            if (!isNaN(y) && !isNaN(m) && !isNaN(d)) {
              const formatted = `${y}å¹´${m}æœˆ${d}æ—¥`;
              dateEl.textContent = formatted;
              if (inlineDateEl) {
                inlineDateEl.textContent = formatted;
              }
              return;
            }
          }
        } catch (e) {
          console.warn('ç„¡æ³•è§£ææ—¥æœŸåƒæ•¸');
        }
      }
      dateEl.textContent = 'å¾…å®‰æ’';
      if (inlineDateEl) {
        inlineDateEl.textContent = 'å¾…å®‰æ’';
      }
    })();
  </script>
  <!-- è‡ªå®šç¾©æ’­æ”¾æŒ‰éˆ•è¡Œç‚ºï¼šç•¶é»æ“Šè¦†è“‹å±¤æ™‚æ’­æ”¾å½±ç‰‡ï¼Œå½±ç‰‡æš«åœæ™‚æ¢å¾©è¦†è“‹å±¤ -->
  <script>
    document.addEventListener('DOMContentLoaded', function () {
      // å°æ–¼æ¯å€‹å½±ç‰‡å®¹å™¨ï¼Œç¶å®šæ’­æ”¾è¦†è“‹å±¤å’Œå®¹å™¨æœ¬èº«çš„é»æ“Šäº‹ä»¶
      const videoItems = document.querySelectorAll('.video-item');
      videoItems.forEach(item => {
        const overlay = item.querySelector('.play-overlay');
        const sourceEl = item.querySelector('source');
        if (!sourceEl || !overlay) return;
        // é»æ“Šè¦†è“‹æŒ‰éˆ•æ™‚æ”¾å¤§æ’­æ”¾
        overlay.addEventListener('click', (e) => {
          e.stopPropagation();
          const src = sourceEl.getAttribute('src');
          if (src) {
            showVideoOverlay(src);
          }
        });
        // é»æ“Šæ•´å€‹å½±ç‰‡å®¹å™¨æ™‚äº¦æ”¾å¤§æ’­æ”¾
        item.addEventListener('click', () => {
          const src = sourceEl.getAttribute('src');
          if (src) {
            showVideoOverlay(src);
          }
        });
      });
    });
  </script>
</body>
</html>